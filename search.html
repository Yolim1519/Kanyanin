<!DOCTYPE html>
<html>
<head>
  <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
  <script src="https://unpkg.com/@zxing/library@latest"></script>
</head>
<body>
  <h1>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

  <input type="text" id="searchInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î">
  <button onclick="search()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>

  <button onclick="startScanner()">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</button><br><br>

  <video id="video" width="300" height="200" style="display:none;"></video>

  <div id="result"></div>

  <script>
    const sheetURL = 'https://script.google.com/macros/s/AKfycbxOGmK7yiVBPRh81GN4DFN9jKZXvqkAyhIv-67HmF61V2OAjYbyGpXVbAzA4wRPeOjmOg/exec';

    async function search() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const res = await fetch(sheetURL);
      const data = await res.json();

      const found = data.find(item =>
        item['‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'].toLowerCase().includes(query) ||
        item['‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î'] === query
      );

      const resultDiv = document.getElementById('result');
      if (found) {
        resultDiv.innerHTML = `
          <h3>${found['‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']}</h3>
          <p>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${found['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']}</p>
          <p>‡∏£‡∏≤‡∏Ñ‡∏≤: ${found['‡∏£‡∏≤‡∏Ñ‡∏≤']} ‡∏ö‡∏≤‡∏ó</p>
          <img src="${found['‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û']}" width="150">
        `;
      } else {
        resultDiv.innerHTML = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
      }
    }

    async function startScanner() {
      const codeReader = new ZXing.BrowserBarcodeReader();
      document.getElementById('video').style.display = 'block';
      try {
        const result = await codeReader.decodeOnceFromVideoDevice(undefined, 'video');
        document.getElementById('searchInput').value = result.text;
        search();
        codeReader.reset();
        document.getElementById('video').style.display = 'none';
      } catch (err) {
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ');
      }
    }
  </script>
</body>
</html>
